<!doctype html>
<html lang="cz">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Teacher digital Agency</title>
    <link rel="stylesheet" href="../static/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/css/styles.min.css">
    <link rel="stylesheet" href="../static/css/main.css">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://raw.githubusercontent.com/furf/jquery-ui-touch-punch/master/jquery.ui.touch-punch.js"></script>
</head>
<body>
<div class="wrapper">
    <div class="content">
        <div class="introduction">
            <img class="logo" src="../static/img/TdA_LOGO/TeacherDigitalAgency_LOGO_black.png">
            <div class="nadpisy text-center p-3 intro-text">Hello TdA!</div> 
        </div>
        <div class="container search">
            <label for="searchInput">Search by:</label>
            <select id="searchSelector" onchange="updateSearchPlaceholder()">
                <option value="name">Name</option>
                <option value="location">Location</option>
                <option value="tags">Tags</option>
            </select>
            <input type="text" id="searchInput" oninput="filterLecturers()" placeholder="Search...">
            
            <!-- the range slider for pricing -->
            <div class="price-range">
                <!-- Range slider -->
                <div id="priceSlider"></div>
                <label for="minPrice">Min Price:</label>
                <input type="number" id="minPrice" min="0" step="1" placeholder="Min Price" oninput="updateSlider()">
                <label for="maxPrice">Max Price:</label>
                <input type="number" id="maxPrice" min="0" step="1" placeholder="Max Price" oninput="updateSlider()">
        
            </div>
        </div>
        <div class="container lecturers">
            {% for lecturer in data %}
            <div class="lecturer" id="{{lecturer['uuid']}}">
                <img class="picture" src="{{lecturer['picture_url']}}"></img>
                <div class="info text-na-bilem" onclick="location.href='/lecturer/{{lecturer['uuid']}}';" style="cursor: pointer;">
                    <div class="name nadpisy">{{lecturer['title_before']}} {{lecturer['first_name']}} {{lecturer['middle_name']}} {{lecturer['last_name']}} {{lecturer['title_after']}}</div>
                    <div class="claim text-na-bilem">{{lecturer['claim']}}</div>
                    <div class="cena text-na-bilem">Cena na hodinu: {{lecturer['price_per_hour']}} Kč</div>
                    <div class="lokace text-na-bilem">Lokace: {{lecturer['location']}}</div>
                </div>
                <div class="tagy text-na-bilem">
                    <div class="nadpisy">Tagy:</div>
                    {% for tag in lecturer['tags'] %}
                    <div class="badge badge-pill tag" onclick="searchByTag('{{tag["name"]}}');" style="cursor: pointer;">{{tag["name"]}}</div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
        <div id="pagination"></div>
    </div> 

    <footer class="text-center text-lg-start" style="background-color: #db6930;">
        <div class="text-center text-white p-3" style="background-color: rgba(0, 0, 0, 0.2);">
            © 2020 Copyright:
            <a class="text-white" href="#">Teacher digital Agency</a>
        </div>
    </footer>
</div>
<script>
    var lecturersPerPage = 5;
    var currentPage = 1;

    function filterLecturers() {
        var searchSelector = $('#searchSelector').val().toLowerCase();
        var searchInput = $('#searchInput').val().toLowerCase();
        var minPrice = parseFloat($('#minPrice').val()) || 0;
        var maxPrice = parseFloat($('#maxPrice').val()) || highestPrice;

        $('.lecturer').each(function() {
            var lecturerData = $(this).find('.info').text().toLowerCase();
            var lecturerPrice = parseFloat($(this).find('.cena').text().replace('Cena na hodinu: ', '').replace(' Kč', '')) || 0;

            if (
                (searchSelector === 'tags' && checkTagSearch(this, searchInput)) ||
                (searchSelector !== 'tags' && checkTextSearch(lecturerData, searchInput)) &&
                checkPriceRange(lecturerPrice, minPrice, maxPrice)
            ) {
                $(this).show();
            } else {
                $(this).hide();
            }
        });

        // Reset current page to 1 after filtering
        currentPage = 1;

        // Update pagination based on the filtered lecturers
        updatePagination();

        // Show/hide lecturers based on the current page
        showLecturersByPage(currentPage);
    }

    function checkTagSearch(lecturerElement, searchInput) {
        var tags = $(lecturerElement).find('.tag').map(function() {
            return $(this).text().toLowerCase();
        }).get();

        return searchInput === '' || tags.some(tag => tag.includes(searchInput));
    }

    function checkTextSearch(lecturerData, searchInput) {
        return searchInput === '' || lecturerData.includes(searchInput);
    }

    function checkPriceRange(price, minPrice, maxPrice) {
        return price >= minPrice && price <= maxPrice;
    }

    function updatePagination() {
        var totalLecturers = $('.lecturer:visible').length;
        var totalPages = Math.ceil(totalLecturers / lecturersPerPage);

        // Generate pagination buttons
        var paginationHTML = '';
        for (var i = 1; i <= totalPages; i++) {
            paginationHTML += '<button class="btn btn-link" onclick="changePage(' + i + ')">' + i + '</button>';
        }

        $('#pagination').html(paginationHTML);
    }

    function showLecturersByPage(page) {
        var startIndex = (page - 1) * lecturersPerPage;
        var endIndex = startIndex + lecturersPerPage;

        if ($('#searchInput').val() === '') {
            $('.lecturer:visible').hide();
            $('.lecturer').slice(startIndex, endIndex).show();
        } else {
            $('.lecturer:visible').hide().slice(startIndex, endIndex).show();
        }
    }

    function changePage(page) {
        currentPage = page;
        showLecturersByPage(currentPage);
    }

    function updateSearchPlaceholder() {
        var searchSelector = $('#searchSelector').val();
        var placeholder = '';

        if (searchSelector === 'name') {
            placeholder = 'Search by Name...';
        } else if (searchSelector === 'location') {
            placeholder = 'Search by Location...';
        } else if (searchSelector === 'tags') {
            placeholder = 'Search by Tags...';
        }

        $('#searchInput').attr('placeholder', placeholder);

        // Trigger a new search when the search selector changes
        filterLecturers();
    }

    function searchByTag(tag) {
        $('#searchSelector').val('tags');
        $('#searchInput').val(tag);
        filterLecturers();
    }

    
    function updateSlider() {
        var minPrice = parseFloat($('#minPrice').val()) || 0;
        var maxPrice = parseFloat($('#maxPrice').val()) || 0;

        // Ensure maxPrice is not less than minPrice
        if (maxPrice < minPrice) {
            maxPrice = minPrice;
            $('#maxPrice').val(maxPrice);
        }

        // Update the slider based on input values
        $("#priceSlider").slider({
            values: [minPrice, maxPrice]
        });
    }

    // Initial setup
    $(document).ready(function() {
        // Add event listener for search selector change
        $('#searchSelector').change(function() {
            updateSearchPlaceholder();
        });
        // Get the highest price for setting the slider's max value
            var highestPrice = Math.max.apply(Math, $('.lecturer').map(function() {
            return parseFloat($(this).find('.cena').text().replace('Cena na hodinu: ', '').replace(' Kč', '')) || 0;
        }).get());
        // Initialize the range slider
        $("#priceSlider").slider({
            range: true,
            min: 0,
            max: highestPrice, // Set an appropriate maximum value for your pricing range
            values: [0, highestPrice], // Initial values
            change: function (event, ui) {
                $("#minPrice").val(ui.values[0]);
                $("#maxPrice").val(ui.values[1]);
                filterLecturers();
                updateSliderDisplay(ui.values[0], ui.values[1]);
            }
        });

        // Display initial range values
        updateSliderDisplay(0, highestPrice); // Set initial values based on your range

        // Filter and show lecturers on page load
        filterLecturers();
        
    });
</script>








</body>
</html>
